<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="data.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="quiz-manager.js"></script>
    <script src="background-image.js"></script>
    <script src="changelog.js"></script>
</head>

<body>
    <nav>
        <ul>
            <li onclick="menuItemClick(this)" data-id="quiz-banners">
                <a>Banners</a>
            </li>
            <li onclick="menuItemClick(this)" data-id="background-image">
                <a>Background</a>
            </li>
        </ul>
    </nav>

    <div id="quiz-banners" class="container text-center p-3" style="display: none;">
        <img name="question" class="d-block mx-auto">
        <div class="pt-3" style="display: inline-flex;">
            <div name="autocomplete" class="position-relative" style="width: 300px;">
                <input type="text" class="form-control" placeholder="Search...">
                <div class="dropdown-menu autocomplete-dropdown"></div>
            </div>
            <button class="btn btn-primary ms-3" style="height: fit-content;">Next</button>
        </div><br>
        <div class="d-flex justify-content-center" name="tries-score">Tries:
            <p name="tries-current" class="ms-1">0</p>
            /
            <p name="tries-max">5</p>
        </div>
        <div name="tries-display" class="mb-3 d-flex justify-content-center tries-icons">
            <div class="try">
            </div>
            <div class="try">
            </div>
            <div class="try">
            </div>
            <div class="try">
            </div>
            <div class="try">
            </div>
        </div>
        <img name="answer-success" class="d-block mx-auto" style="max-height: 700px;">
    </div>

    <div id="background-image" class="container text-center p-3" style="display: none;">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            new QuizManager('quiz-banners').init();
            new BackgroundManager('background-image').init();
            document.querySelector('.version').textContent = `v${changelogData[0].version}`;
        });

        function getRandomInt(min, max) {
            return Math.round(Math.random() * (max - min) + min);
        }

        function getRandomCharacter() {
            return data[getRandomInt(0, data.length - 1)];
        }

        function menuItemClick(menuItem) {
            // deactivate other menu items
            document.querySelectorAll("nav > ul > li").forEach(element => {
                if (element !== menuItem) {
                    element.classList.remove('active');
                }
            });
            // activate this menu item
            menuItem.classList.toggle('active');

            // hide other content
            const content = document.querySelector('#' + menuItem.dataset.id);
            document.querySelectorAll("div.container").forEach(element => {
                if (element !== content) {
                    element.style.display = 'none';
                }
            });
            // toggle this content
            content.style.display = content.style.display === 'none' ? 'inherit' : 'none';
        }

        function renderChangelog() {
            const container = document.getElementById("changelogContent");
            container.innerHTML = ""; // Clear existing content

            changelogData.forEach(entry => {
                // Outer container for this version
                const versionContainer = document.createElement("div");
                versionContainer.className = "mb-5";

                // Header with version and date
                const headerDiv = document.createElement("div");
                headerDiv.className = "d-flex align-items-baseline mb-4";

                const versionTag = document.createElement("h2");
                versionTag.className = "version-tag me-3";
                versionTag.textContent = entry.version;
                headerDiv.appendChild(versionTag);

                const dateSpan = document.createElement("span");
                dateSpan.className = "changelog-date";
                dateSpan.textContent = entry.date;
                headerDiv.appendChild(dateSpan);

                versionContainer.appendChild(headerDiv);

                // Container for the list of changes
                const entriesContainer = document.createElement("div");
                entriesContainer.className = "bg-white shadow-sm rounded";

                // Process each change category in a fixed order
                const changeTypes = ["added", "fixed", "updated"];
                changeTypes.forEach(type => {
                    const changesForType = entry.changes[type];
                    if (changesForType.length === 0) return;
                    const changeEntry = document.createElement("div");
                    changeEntry.className = "changelog-entry position-relative p-4";

                    // Indicator for change type
                    const changeTypeIndicator = document.createElement("div");
                    changeTypeIndicator.className = "change-type " + type;
                    changeEntry.appendChild(changeTypeIndicator);

                    // Text container
                    const textContainer = document.createElement("div");
                    textContainer.className = "ms-3";

                    const titleEl = document.createElement("h6");
                    titleEl.className = "fw-bold mb-3";
                    // Capitalize the first letter
                    titleEl.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                    textContainer.appendChild(titleEl);
                    
                    const listEl = document.createElement("ul");
                    changesForType.forEach(change => {
                        const descriptionEl = document.createElement("li");
                        descriptionEl.className = "text-muted mb-0";
                        descriptionEl.textContent = change;
                        listEl.appendChild(descriptionEl);
                    });
                    changeEntry.appendChild(textContainer);
                    textContainer.appendChild(listEl);
                    entriesContainer.appendChild(changeEntry);
                });

                versionContainer.appendChild(entriesContainer);
                container.appendChild(versionContainer);
            });
        }


    </script>

    <!-- Updated clickable element to open modal -->
    <div class="version" data-bs-toggle="modal" data-bs-target="#versionModal" onclick="renderChangelog()"></div>

    <!-- Modal -->
    <div class="modal fade" id="versionModal" tabindex="-1" aria-labelledby="versionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="versionModalLabel">Changelog</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4" id="changelogContent">
                    <!-- Changelog entries will be dynamically injected here -->
                </div>
                <!-- <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div> -->
            </div>
        </div>
    </div>
</body>

</html>